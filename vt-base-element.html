<link rel="import" href="../polymer/polymer.html">

<polymer-element name="vt-base-element" attributes="m_id factory_id" factory_id="factory">
  <script>
    Polymer('vt-base-element',{

      ready : function(){
        this.cancelUnbindAll();
        this.updateFactory();
        this.updateModel();
      },

      detached : function(){
        this.cancelUnbindAll();
      },

      updateFactory: function(){
        this.factory = document.querySelector('#' + this.factory_id);
      },

      updateModel: function(){        
        if(! this.factory)
          return;

        this.model = this.factory.getModel(this.m_id);        
        if(this.model)
          return;

        this.model = this.factory.createModel(this.localName);
        if(!this.model){
          this.removeAttribute('m_id');
          return;
        }

        this.setAttribute('m_id', this.model.id);
      },

      factory_idChanged : function(){
        this.updateFactory();
      },

      m_idChanged : function(){        
        this.updateModel();
      }

    });
  </script>
</polymer-element>