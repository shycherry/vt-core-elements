<link rel="import" href="./vt-model-element.html">

<!-- events: statusChanged (enqueued, canceled, working, dropped) -->
<polymer-element name="vt-shell" extends="vt-model-element">
  <template>
    <link rel="stylesheet" href="vt-shell.css"/>
    <div id="shellContainer">
      <div id="viewport"></div>
      <div id="shelltasksContainer">
        <content></content>
      </div>
      <div id="inputbar">
        <input id="commandInput"/>
        <button on-click="{{enqueueTask}}">Enqueue</button>
      </div>
    </div>
  </template>
  <script>
    var ChildProcess = global.require('child_process');
    var Async = global.require('async');

    Polymer('vt-shell',{      
      created : function(){
        this.queue = new Async.queue(this.doTask.bind(this), 1);
        this.tasks = [];
      },
      doTask : function(){

      },
      domReady : function(){
        shelltasks = this.$.shelltasksContainer.querySelectorAll('vt-shelltask');
        console.log(shelltasks);
      },
      addTaskElt : function(iTaskElt){
        // this.tasks.push(taskElt);
        this.$.shelltasksContainer.appendChild(iTaskElt);
      },
      enqueueTask : function(){
        var userCmd = this.$.commandInput.value;
        if(!userCmd)
          return;
        
        var newTaskData = {
          command: userCmd
        };
        
        var newTaskElt = document.createElement('vt-shelltask');        
        newTaskElt.data = newTaskData;

        this.addTaskElt(newTaskElt);
      }
    });
  </script>
</polymer-element>